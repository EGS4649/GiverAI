<!DOCTYPE html>
<html>
<head>
    <title>IP Ban Management - GiverAI Admin</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; }
        input, textarea, select { width: 300px; padding: 8px; }
        button { padding: 10px 20px; background: #dc3545; color: white; border: none; border-radius: 4px; }
        .unban-btn { background: #28a745; }
        .success { color: green; padding: 10px; background: #d4edda; margin: 10px 0; }
        .error { color: red; padding: 10px; background: #f8d7da; margin: 10px 0; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
    </style>
</head>
<body>
    <h1>IP Ban Management</h1>
    
    {% if request.args.get('success') == 'banned' %}
        <div class="success">IP address banned successfully!</div>
    {% endif %}
    {% if request.args.get('success') == 'unbanned' %}
        <div class="success">IP address unbanned successfully!</div>
    {% endif %}
    {% if error %}
        <div class="error">{{ error }}</div>
    {% endif %}
    
    <form method="post" action="/admin/ban-ip">
        <div class="form-group">
            <label>IP Address:</label>
            <input type="text" name="ip_address" required placeholder="192.168.1.1">
        </div>
        <div class="form-group">
            <label>Reason:</label>
            <textarea name="reason" required placeholder="Reason for ban..."></textarea>
        </div>
        <div class="form-group">
            <label>Duration (hours) - leave empty for permanent:</label>
            <input type="number" name="duration_hours" placeholder="24">
        </div>
        <button type="submit">Ban IP</button>
    </form>
    
    <h2>Active Bans ({{ active_bans|length }})</h2>
    <table>
        <thead>
            <tr>
                <th>IP Address</th>
                <th>Reason</th>
                <th>Banned By</th>
                <th>Banned At</th>
                <th>Expires At</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {% for ban in active_bans %}
            <tr>
                <td>{{ ban.ip_address }}</td>
                <td>{{ ban.reason }}</td>
                <td>{{ ban.banned_by }}</td>
                <td>{{ ban.banned_at.strftime('%Y-%m-%d %H:%M') }}</td>
                <td>{% if ban.expires_at %}{{ ban.expires_at.strftime('%Y-%m-%d %H:%M') }}{% else %}Permanent{% endif %}</td>
                <td>
                    <form method="post" action="/admin/unban-ip" style="display: inline;">
                        <input type="hidden" name="ban_id" value="{{ ban.id }}">
                        <button type="submit" class="unban-btn">Unban</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    
    <p><a href="/admin">Back to Admin Dashboard</a></p>
</body>
</html>
